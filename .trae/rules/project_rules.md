1. node包管理器使用pnpm
2. think in English，write in Chinese
3. 项目名称使用中划线分隔，例如：my-qt6-app
4. cloudflare workers 脚本语言使用python

## 分层架构设计

### 架构层次

1. **表示层 (Presentation Layer)**
   - UI组件和界面逻辑
   - 用户交互处理
   - 视图状态管理

2. **业务逻辑层 (Business Logic Layer)**
   - 核心业务规则
   - 数据验证和处理
   - 业务流程控制

3. **数据访问层 (Data Access Layer)**
   - 数据库操作
   - API调用
   - 数据持久化

4. **基础设施层 (Infrastructure Layer)**
   - 配置管理
   - 日志记录
   - 工具类和帮助函数

### 设计模式应用

- **MVC/MVP模式**: 分离视图、模型和控制器
- **单例模式**: 全局配置和会话管理
- **工厂模式**: 组件创建和依赖注入
- **观察者模式**: 事件处理和状态通知
- **策略模式**: 算法和业务规则的可替换实现

## 项目结构重构

### 目录结构规范

```txt
myqt6app/
├── src/                    # 源代码目录
│   ├── ui/                 # UI层
│   │   ├── components/     # 可复用组件
│   │   ├── windows/        # 窗口类
│   │   └── dialogs/        # 对话框
│   ├── business/           # 业务逻辑层
│   │   ├── services/       # 业务服务
│   │   ├── models/         # 数据模型
│   │   └── validators/     # 数据验证
│   ├── data/               # 数据访问层
│   │   ├── repositories/   # 数据仓库
│   │   ├── api/            # API客户端
│   │   └── database/       # 数据库操作
│   ├── infrastructure/     # 基础设施层
│   │   ├── config/         # 配置管理
│   │   ├── logging/        # 日志系统
│   │   ├── security/       # 安全相关
│   │   └── utils/          # 工具类
│   └── main.py             # 应用入口
├── worker/                 # Cloudflare Workers后端
│   ├── src/                # Worker源代码
│   ├── package.json        # Node.js依赖配置
│   ├── wrangler.toml       # Cloudflare配置
│   └── schema.sql          # 数据库架构
├── tests/                  # 测试代码
├── docs/                   # 文档
├── assets/                 # 静态资源
├── config/                 # 配置文件
└── requirements.txt        # Python依赖
```

### 模块化原则

- 每个模块职责单一
- 模块间低耦合高内聚
- 清晰的接口定义
- 避免循环依赖

## 依赖管理优化

### Python依赖管理

1. **requirements.txt**: 生产环境依赖
2. **requirements-dev.txt**: 开发环境依赖
3. **版本锁定**: 使用具体版本号避免兼容性问题
4. **虚拟环境**: 使用venv隔离环境

### 依赖注入

- 使用依赖注入容器管理对象生命周期
- 接口编程，降低具体实现的耦合
- 配置驱动的依赖关系

### 第三方库选择原则

- 优先选择活跃维护的库
- 考虑库的大小和性能影响
- 评估安全性和许可证兼容性
- 避免过度依赖

## 开发原则

### SOLID原则

1. **单一职责原则 (SRP)**: 一个类只有一个引起它变化的原因
2. **开闭原则 (OCP)**: 对扩展开放，对修改关闭
3. **里氏替换原则 (LSP)**: 子类必须能够替换其基类
4. **接口隔离原则 (ISP)**: 不应该强迫客户依赖它们不使用的接口
5. **依赖倒置原则 (DIP)**: 高层模块不应该依赖低层模块

### 代码质量原则

1. **DRY (Don't Repeat Yourself)**: 避免代码重复
2. **KISS (Keep It Simple, Stupid)**: 保持简单
3. **YAGNI (You Aren't Gonna Need It)**: 不要过度设计
4. **测试驱动开发 (TDD)**: 先写测试再写代码
5. **持续重构**: 定期改进代码结构

### 编码规范

1. **命名规范**:
   - 类名使用PascalCase
   - 函数和变量使用snake_case
   - 常量使用UPPER_CASE
   - 私有成员使用下划线前缀

2. **注释规范**:
   - 使用docstring描述类和函数
   - 复杂逻辑添加行内注释
   - 保持注释与代码同步

3. **错误处理**:
   - 使用异常处理机制
   - 记录详细的错误信息
   - 优雅的错误恢复

### 安全原则

1. **输入验证**: 验证所有用户输入
2. **权限控制**: 实现细粒度的访问控制
3. **数据加密**: 敏感数据加密存储和传输
4. **安全日志**: 记录安全相关事件
5. **定期更新**: 及时更新依赖库修复安全漏洞

### 性能原则

1. **延迟加载**: 按需加载资源
2. **缓存策略**: 合理使用缓存提高性能
3. **异步处理**: 使用异步操作避免阻塞
4. **资源管理**: 及时释放不需要的资源
5. **性能监控**: 监控关键性能指标
